<!DOCTYPE html>
<html lang="bn">

<head>
	<meta charset="utf-8">
	<title>‡¶´‡¶∞‡¶Æ-‡ßß‡ßÆ - ‡¶™‡ßç‡¶∞‡¶ø‡¶ú‡¶æ‡¶á‡¶°‡¶ø‡¶Ç ‡¶Ö‡¶´‡¶ø‡¶∏‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßç‡¶§‡ßÉ‡¶ï ‡¶∏‡¶∞‡¶¨‡¶∞‡¶æ‡¶π‡¶ï‡ßÉ‡¶§ ‡¶≠‡ßã‡¶ü ‡¶ó‡¶£‡¶®‡¶æ‡¶∞ ‡¶´‡¶≤‡¶æ‡¶´‡¶≤‡ßá‡¶∞ ‡¶è‡¶ï‡ßÄ‡¶≠‡ßÇ‡¶§ ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£‡ßÄ</title>
	<style>
		@page {
			size: 8.5in 14in;
			margin: 0.3in;
		}

		body {
			width: 8.5in;
			margin: 0.3in auto;
			padding: 0;
			background: white;
			font-family: 'Nikosh', 'Arial Unicode MS', sans-serif;
			color: #000;
		}

		p {
			margin: 0;
			padding: 0.02in 0;
			line-height: 1.2;
		}

		/* Header section */
		.doc-header {
			text-align: center;
			margin-bottom: 0.15in;
		}

		.doc-header .form-num {
			font-size: 14pt;
			font-weight: bold;
			margin-bottom: 0.05in;
		}

		.doc-header .rule-ref {
			font-size: 11pt;
			margin-bottom: 0.1in;
		}

		.doc-header .election-title {
			font-size: 14pt;
			font-weight: bold;
		}

		.doc-header .main-heading {
			font-size: 12pt;
			margin-top: 0.05in;
		}

		/* Content below the heading - specified as 11pt */
		.form-content {
			font-size: 11pt;
		}

		table {
			width: 100%;
			border-collapse: collapse;
			margin-bottom: 0.1in;
		}

		td {
			border: 1px solid #000;
			padding: 4px 6px;
			vertical-align: top;
		}

		.no-border td {
			border: none;
		}

		.border-left {
			border-left: 1px solid #000;
		}

		.border-right {
			border-right: 1px solid #000;
		}

		.border-top {
			border-top: 1px solid #000;
		}

		.border-bottom {
			border-bottom: 1px solid #000;
		}

		.center {
			text-align: center;
		}

		.right {
			text-align: right;
		}

		.bold {
			font-weight: bold;
		}

		.gray-bg {
			background-color: #c0c0c0;
			color: #000;
			font-size: 9pt;
			text-align: center;
		}

		.valign-middle {
			vertical-align: middle;
		}

		.percentage {
			color: #f00;
			font-weight: bold;
		}

		.date-box {
			display: inline-block;
			width: 0.2in;
			height: 0.2in;
			border: 1px solid #000;
			text-align: center;
			margin-right: 2px;
		}

		@media print {
			body {
				margin: 0;
				box-shadow: none;
				width: 100%;
			}

			.no-print {
				display: none;
			}
		}

		.left {
			text-align: left;
		}
	</style>
</head>

<body>

	<div class="no-print" style="padding: 20px; background: #f0f0f0; margin-bottom: 20px; border-radius: 8px;">
		<h3 style="margin-bottom: 10px;">‡¶´‡¶∞‡¶Æ-‡ßß‡ßÆ ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â</h3>
		<button onclick="window.print()" style="padding: 10px 20px; background: #3b82f6; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px;">
			üñ®Ô∏è ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
		</button>
		<button onclick="window.location.href='result_entry.html'" style="padding: 10px 20px; background: #64748b; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; margin-left: 10px;">
			‚Üê ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®
		</button>
	</div>

	<div class="doc-header">
		<p class="form-num"><sup>‡ßß</sup>‡¶´‡¶∞‡¶Æ-‡ßß‡ßÆ</p>
		<p class="rule-ref">[‡¶¨‡¶ø‡¶ß‡¶ø ‡ß®‡ß¨ (‡ßß) ‡¶¶‡ßç‡¶∞‡¶∑‡ßç‡¶ü‡¶¨‡ßç‡¶Ø]</p>
		<p class="election-title">‡¶§‡ßç‡¶∞‡ßü‡ßã‡¶¶‡¶∂ ‡¶ú‡¶æ‡¶§‡ßÄ‡ßü ‡¶∏‡¶Ç‡¶∏‡¶¶ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®</p>
		<p class="main-heading">‡¶™‡ßç‡¶∞‡¶ø‡¶ú‡¶æ‡¶á‡¶°‡¶ø‡¶Ç ‡¶Ö‡¶´‡¶ø‡¶∏‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßç‡¶§‡ßÉ‡¶ï ‡¶∏‡¶∞‡¶¨‡¶∞‡¶æ‡¶π‡¶ï‡ßÉ‡¶§ ‡¶≠‡ßã‡¶ü ‡¶ó‡¶£‡¶®‡¶æ‡¶∞ ‡¶´‡¶≤‡¶æ‡¶´‡¶≤‡ßá‡¶∞ ‡¶è‡¶ï‡ßÄ‡¶≠‡ßÇ‡¶§ ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£‡ßÄ</p>
	</div>

	<div class="form-content">
		<!-- Area Info -->
		<table style="border: none; margin-bottom: 0.2in;">
			<tr>
				<td style="border: none; border-right: 1px solid #000; width: 25%;">‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®‡ßÄ ‡¶è‡¶≤‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶ì ‡¶®‡¶æ‡¶Æ :</td>
				<td style="border: 1px solid #000;">‡ß®‡ß¨‡ß¨, ‡¶´‡ßá‡¶®‡ßÄ-‡ß¶‡ß®</td>
			</tr>
		</table>

		<!-- Main Results Table -->
		<table id="mainResultsTable">
			<thead class="center bold">
				<tr>
					<td rowspan="3" style="width: 5%;">‡¶ï‡ßá‡¶®‡ßç‡¶¶‡ßç‡¶∞ ‡¶ï‡ßã‡¶°</td>
					<td rowspan="3" style="width: 20%;">‡¶≠‡ßã‡¶ü‡¶ï‡ßá‡¶®‡ßç‡¶¶‡ßç‡¶∞‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</td>
					<td rowspan="3" style="width: 8%;">‡¶Æ‡ßã‡¶ü ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ</td>
					<td id="candidateHeaderColspan" colspan="11">‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¶‡ßç‡¶¨‡¶®‡ßç‡¶¶‡ßç‡¶¨‡ßÄ ‡¶™‡ßç‡¶∞‡¶æ‡¶∞‡ßç‡¶•‡ßÄ‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶ï‡ßÇ‡¶≤‡ßá ‡¶™‡ßç‡¶∞‡¶¶‡¶§‡ßç‡¶§ ‡¶¨‡ßà‡¶ß ‡¶≠‡ßã‡¶ü‡ßá‡¶∞ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ (‡¶Ü‡¶™‡¶§‡ßç‡¶§‡¶ø‡¶ï‡ßÉ‡¶§ ‡¶≠‡ßã‡¶ü‡¶∏‡¶π)</td>
					<td colspan="4">‡¶™‡ßç‡¶∞‡¶§‡ßç‡¶Ø‡ßá‡¶ï ‡¶ï‡ßá‡¶®‡ßç‡¶¶‡ßç‡¶∞‡ßá ‡¶Æ‡ßã‡¶ü ‡¶≠‡ßã‡¶ü‡ßá‡¶∞ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ</td>
					<td rowspan="3" style="width: 8%;">‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø</td>
				</tr>
				<tr>
					<td id="candidateNamesRow" colspan="11">‡¶™‡ßç‡¶∞‡¶æ‡¶∞‡ßç‡¶•‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ (‡¶™‡ßç‡¶∞‡¶§‡ßÄ‡¶ï)</td>
					<td rowspan="2" style="width: 5%;">‡¶¨‡ßà‡¶ß</td>
					<td rowspan="2" style="width: 5%;">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤‡¶ï‡ßÉ‡¶§</td>
					<td rowspan="2" style="width: 5%;">‡¶Æ‡ßã‡¶ü</td>
					<td rowspan="2" style="width: 5%;">‡¶ü‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞‡ßç‡¶° ‡¶≠‡ßã‡¶ü‡ßá‡¶∞ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ</td>
				</tr>
				<tr id="candidateSymbolsRow">
					<!-- Dynamic candidate columns will be added here -->
				</tr>
				<tr class="gray-bg" id="columnNumbersRow">
					<td>(‡ßß)</td>
					<td>‡ß®</td>
					<td>‡ß©</td>
					<!-- Dynamic column numbers will be added here -->
					<td>‡ß´</td>
					<td>‡ß¨</td>
					<td>‡ß≠</td>
					<td>‡ßÆ</td>
					<td>‡ßØ</td>
				</tr>
			</thead>
			<tbody id="resultsTableBody">
				<tr class="center">
					<td colspan="24">‚è≥ ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</td>
				</tr>
			</tbody>
		</table>

		<!-- Totals Breakdown -->
		<table style="margin-top: 0.2in;">
			<tr>
				<td style="width: 40%; border: none; border-right: 1px solid #000;" class="bold">‡¶≠‡ßã‡¶ü ‡¶ï‡ßá‡¶®‡ßç‡¶¶‡ßç‡¶∞‡¶∏‡¶Æ‡ßÇ‡¶π‡ßá
					‡¶™‡ßç‡¶∞‡¶¶‡¶§‡ßç‡¶§ ‡¶≠‡ßã‡¶ü‡ßá‡¶∞ ‡¶Æ‡ßã‡¶ü ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ :</td>
				<td style="border: 1px solid #000;" id="totalCentreVotes">&nbsp;</td>
			</tr>
			<tr>
				<td style="border: none; border-right: 1px solid #000;" class="bold">‡¶™‡ßã‡¶∏‡ßç‡¶ü‡¶æ‡¶≤ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡¶ü ‡¶™‡ßá‡¶™‡¶æ‡¶∞‡¶Ø‡ßã‡¶ó‡ßá ‡¶™‡ßç‡¶∞‡¶¶‡¶§‡ßç‡¶§
					‡¶≠‡ßã‡¶ü‡ßá‡¶∞ ‡¶Æ‡ßã‡¶ü ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ :</td>
				<td style="border: 1px solid #000;" id="totalPostalVotes">‡ß¶</td>
			</tr>
			<tr>
				<td style="border: none; border-right: 1px solid #000;" class="bold">‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü :</td>
				<td style="border: 1px solid #000;" id="grandTotalVotes">&nbsp;</td>
			</tr>
		</table>

		<!-- Footer Signature Section -->
		<table style="margin-top: 0.3in; border: none;" class="no-border">
			<tr>
				<td style="width: 10%; vertical-align: middle;">‡¶∏‡ßç‡¶•‡¶æ‡¶®‡¶É</td>
				<td style="width: 40%; border: 1px solid #000;">‡¶∞‡¶ø‡¶ü‡¶æ‡¶∞‡ßç‡¶®‡¶ø‡¶Ç ‡¶Ö‡¶´‡¶ø‡¶∏‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶æ‡¶≤‡ßü, ‡¶´‡ßá‡¶®‡ßÄ‡•§</td>
				<td style="width: 10%;">&nbsp;</td>
				<td style="width: 40%; border: 1px solid #000; height: 0.6in;">&nbsp;</td>
			</tr>
			<tr>
				<td>&nbsp;</td>
				<td>&nbsp;</td>
				<td>&nbsp;</td>
				<td class="center">‡¶∞‡¶ø‡¶ü‡¶æ‡¶∞‡ßç‡¶®‡¶ø‡¶Ç ‡¶Ö‡¶´‡¶ø‡¶∏‡¶æ‡¶∞‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ, ‡¶™‡¶¶‡¶¨‡ßÄ ‡¶ì ‡¶∏‡ßç‡¶¨‡¶æ‡¶ï‡ßç‡¶∑‡¶∞</td>
			</tr>
		</table>

		<table style="margin-top: 0.1in; border: none;" class="no-border">
			<tr>
				<td style="width: 10%; vertical-align: middle;">‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ :</td>
				<td style="width: 40%;">
					<span class="date-box">‡ßß</span><span class="date-box">‡ß®</span> ‡¶¶‡¶ø‡¶®
					<span class="date-box">‡ß¶</span><span class="date-box">‡ß®</span> ‡¶Æ‡¶æ‡¶∏
					<span class="date-box">‡ß®</span><span class="date-box">‡ß¶</span><span class="date-box">‡ß®</span><span
						class="date-box">‡ß¨</span> ‡¶¨‡ßé‡¶∏‡¶∞
				</td>
				<td colspan="2">&nbsp;</td>
			</tr>
		</table>

		<!-- Candidate/Agent Signatures -->
		<p class="center bold" style="margin-top: 0.2in; border-bottom: 1px solid #000; padding: 5px;">‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¶‡ßç‡¶¨‡¶®‡ßç‡¶¶‡ßç‡¶¨‡ßÄ
			‡¶™‡ßç‡¶∞‡¶æ‡¶∞‡ßç‡¶•‡ßÄ/ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®‡ßÄ ‡¶è‡¶ú‡ßá‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ì ‡¶∏‡ßç‡¶¨‡¶æ‡¶ï‡ßç‡¶∑‡¶∞</p>
		<table style="margin-top: 0;">
			<thead class="center bold">
				<tr>
					<td style="width: 35%;">‡¶®‡¶æ‡¶Æ</td>
					<td style="width: 40%;">‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¶‡ßç‡¶¨‡¶®‡ßç‡¶¶‡ßç‡¶¨‡ßÄ ‡¶™‡ßç‡¶∞‡¶æ‡¶∞‡ßç‡¶•‡ßÄ/ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®‡ßÄ ‡¶è‡¶ú‡ßá‡¶®‡ßç‡¶ü<br>(‡¶Ø‡¶æ‡¶π‡¶æ ‡¶™‡ßç‡¶∞‡¶Ø‡ßã‡¶ú‡ßç‡¶Ø ‡¶§‡¶æ‡¶π‡¶æ ‡¶â‡¶≤‡ßç‡¶≤‡ßá‡¶ñ ‡¶ï‡¶∞‡¶ø‡¶§‡ßá ‡¶π‡¶á‡¶¨‡ßá)</td>
					<td style="width: 25%;">‡¶∏‡ßç‡¶¨‡¶æ‡¶ï‡ßç‡¶∑‡¶∞</td>
				</tr>
			</thead>
			<tbody id="candidateSignaturesBody">
				<tr>
					<td style="height: 0.3in;">&nbsp;</td>
					<td>&nbsp;</td>
					<td>&nbsp;</td>
				</tr>
				<tr>
					<td style="height: 0.3in;">&nbsp;</td>
					<td>&nbsp;</td>
					<td>&nbsp;</td>
				</tr>
				<tr>
					<td style="height: 0.3in;">&nbsp;</td>
					<td>&nbsp;</td>
					<td>&nbsp;</td>
				</tr>
			</tbody>
		</table>
	</div>

	<script type="module">
		import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

		const SUPABASE_URL = window.SUPABASE_URL || 'https://tschsyozvlneslqylqii.supabase.co';
		const SUPABASE_KEY = window.SUPABASE_KEY || window.SUPABASE_ANON_KEY || 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRzY2hzeW96dmxuZXNscXlscWlpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY3MzcyNjgsImV4cCI6MjA4MjMxMzI2OH0.7kfq7K-jbFmgnin2zkLJf7GIulGXvfQzBkzjs0iAO14';

		let supabase = null;
		if (SUPABASE_URL && SUPABASE_KEY && SUPABASE_KEY !== 'YOUR_SUPABASE_ANON_KEY') {
			try {
				supabase = createClient(SUPABASE_URL, SUPABASE_KEY);
				window.supabaseClient = supabase;
			} catch (err) {
				console.error('Supabase init error:', err);
			}
		}

		const bengaliNumbers = ['‡ß¶', '‡ßß', '‡ß®', '‡ß©', '‡ß™', '‡ß´', '‡ß¨', '‡ß≠', '‡ßÆ', '‡ßØ'];
		const bengaliLetters = ['‡¶ï', '‡¶ñ', '‡¶ó', '‡¶ò', '‡¶ô', '‡¶ö', '‡¶õ', '‡¶ú', '‡¶ù', '‡¶û', '‡¶ü'];

		function toBengaliNumber(num) {
			return String(num).split('').map(d => bengaliNumbers[parseInt(d)] || d).join('');
		}

		async function loadFormData() {
			if (!supabase) {
				alert('Supabase not configured');
				return;
			}

			try {
				// Fetch candidates
				const { data: candidates, error: candidateError } = await supabase
					.from('candidate_db')
					.select('*')
					.order('candidate_identity');

				if (candidateError) throw candidateError;

				// Fetch all election results with centre info
				const { data: results, error: resultsError } = await supabase
					.from('election_result')
					.select('*')
					.order('vote_centre_code', { ascending: true });

				if (resultsError) throw resultsError;

				// Fetch all vote centres
				const { data: centres, error: centresError } = await supabase
					.from('vote_centre')
					.select('*');

				if (centresError) throw centresError;

				// Fetch agents
				const { data: agents, error: agentsError } = await supabase
					.from('agent_name_db')
					.select('*')
					.eq('agent_status', true);

				if (agentsError) console.warn('Error fetching agents:', agentsError);

				// Create centre map
				const centreMap = new Map(centres.map(c => [c.vote_centre_iid, c]));

				// Merge data
				const mergedResults = results.map(r => ({
					...r,
					centre: centreMap.get(r.vote_centre_iid) || {}
				}));

				// Sort by centre code so duplicates stay adjacent
				const sortedResults = mergedResults.slice().sort((a, b) => {
					const codeA = Number(a.centre?.vote_centre_code ?? a.vote_centre_code ?? 0);
					const codeB = Number(b.centre?.vote_centre_code ?? b.vote_centre_code ?? 0);
					if (codeA !== codeB) return codeA - codeB;
					return (a.vote_centre_iid ?? 0) - (b.vote_centre_iid ?? 0);
				});

				// Render dynamic candidate headers
				renderCandidateHeaders(candidates);

				// Render table rows
				renderTableData(sortedResults, candidates, agents || []);

			} catch (error) {
				console.error('Error loading data:', error);
				document.getElementById('resultsTableBody').innerHTML = `
					<tr class="center">
						<td colspan="24" style="color: red;">‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ${error.message}</td>
					</tr>
				`;
			}
		}

		function renderCandidateHeaders(candidates) {
			const symbolsRow = document.getElementById('candidateSymbolsRow');
			const numbersRow = document.getElementById('columnNumbersRow');
			
			// Update colspan
			document.getElementById('candidateHeaderColspan').setAttribute('colspan', candidates.length);
			document.getElementById('candidateNamesRow').setAttribute('colspan', candidates.length);

			// Clear and add candidate symbol columns
			symbolsRow.innerHTML = '';
			candidates.forEach((candidate, index) => {
				const td = document.createElement('td');
				td.style.width = '4%';
				td.style.fontSize = '8pt';
				td.innerHTML = `${candidate.candidate_name || ''}<br>(${candidate.candidate_sign_name || ''})`;
				symbolsRow.appendChild(td);
			});

			// Update column numbers row
			const currentNumbers = numbersRow.querySelectorAll('td');
			// Remove old candidate number columns (between column 3 and column 5)
			while (currentNumbers.length > 3 && currentNumbers[3].textContent !== '‡ß´') {
				currentNumbers[3].remove();
			}

			// Insert candidate column numbers after column 3
			candidates.forEach((candidate, index) => {
				const td = document.createElement('td');
				td.textContent = `‡ß™ (${bengaliLetters[index] || index + 1})`;
				numbersRow.insertBefore(td, currentNumbers[3]);
			});
		}

		function renderTableData(results, candidates, agents) {
			const tbody = document.getElementById('resultsTableBody');
			tbody.innerHTML = '';

			let totalVoters = 0;
			let totalValid = 0;
			let totalInvalid = 0;
			let totalCounted = 0;
			let totalTendered = 0;
			const candidateTotals = new Array(candidates.length).fill(0);

			results.forEach((result, index) => {
				const tr = document.createElement('tr');
				tr.className = 'center';

				const centreName = result.centre?.vote_centre_name || 'N/A';
				const voteCentreCode = result.centre?.vote_centre_code ?? result.vote_centre_code ?? '';
				const totalVoter = parseFloat(result.centre?.total_voter || 0);
				const validVotes = parseFloat(result.valid_counted_vote || 0);
				const invalidVotes = parseFloat(result.invalid_counted_vote || 0);
				const tenderedVotes = parseFloat(result.tenderd_counted_vote || 0);
				const totalVotes = validVotes + invalidVotes;

				const percentage = totalVoter > 0 ? ((totalVotes / totalVoter) * 100).toFixed(2) : '0.00';

				totalVoters += totalVoter;
				totalValid += validVotes;
				totalInvalid += invalidVotes;
				totalCounted += totalVotes;
				totalTendered += tenderedVotes;

				// Centre code from vote_centre table
				tr.innerHTML += `<td>${voteCentreCode ? toBengaliNumber(voteCentreCode) : ''}</td>`;
				
				// Centre name
				tr.innerHTML += `<td class="left">${centreName}</td>`;
				
				// Total voter
				tr.innerHTML += `<td>${toBengaliNumber(totalVoter)}</td>`;

				// Candidate votes
				candidates.forEach((candidate, idx) => {
					const voteCount = parseFloat(result[`candidate_${idx + 1}`] || 0);
					candidateTotals[idx] += voteCount;
					tr.innerHTML += `<td>${toBengaliNumber(voteCount)}</td>`;
				});

				// Valid, Invalid, Total, Tendered
				tr.innerHTML += `<td>${toBengaliNumber(validVotes)}</td>`;
				tr.innerHTML += `<td>${toBengaliNumber(invalidVotes)}</td>`;
				tr.innerHTML += `<td>${toBengaliNumber(totalVotes)}</td>`;
				tr.innerHTML += `<td>${toBengaliNumber(tenderedVotes)}</td>`;

				// Comment (percentage) shown in Bengali numerals
				tr.innerHTML += `<td class="percentage">${toBengaliNumber(percentage)}%</td>`;

				tbody.appendChild(tr);
			});

			// Add total row
			const totalRow = document.createElement('tr');
			totalRow.className = 'bold';
			totalRow.innerHTML = `<td colspan="2" class="right">‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü</td>`;
			totalRow.innerHTML += `<td class="center">${toBengaliNumber(totalVoters)}</td>`;

			// Candidate totals
			candidateTotals.forEach(total => {
				totalRow.innerHTML += `<td class="center">${toBengaliNumber(total)}</td>`;
			});

			totalRow.innerHTML += `<td class="center">${toBengaliNumber(totalValid)}</td>`;
			totalRow.innerHTML += `<td class="center">${toBengaliNumber(totalInvalid)}</td>`;
			totalRow.innerHTML += `<td class="center">${toBengaliNumber(totalCounted)}</td>`;
			totalRow.innerHTML += `<td class="center">${toBengaliNumber(totalTendered)}</td>`;

			const avgPercentage = totalVoters > 0 ? ((totalCounted / totalVoters) * 100).toFixed(2) : '0.00';
			totalRow.innerHTML += `<td class="center percentage">${toBengaliNumber(avgPercentage)}%</td>`;

			tbody.appendChild(totalRow);

			// Update totals breakdown
			document.getElementById('totalCentreVotes').textContent = toBengaliNumber(totalCounted);
			document.getElementById('grandTotalVotes').textContent = toBengaliNumber(totalCounted);

			// Render candidate signatures
			renderCandidateSignatures(candidates, agents);
		}

		function renderCandidateSignatures(candidates, agents) {
			const tbody = document.getElementById('candidateSignaturesBody');
			tbody.innerHTML = '';

			// Display agents if available
			if (agents && agents.length > 0) {
				agents.forEach((agent, index) => {
					const tr = document.createElement('tr');
					tr.innerHTML = `
						<td style="height: 0.3in;">${toBengaliNumber(index + 1)}‡•§ ${agent.agent_name || ''}</td>
						<td> ${agent.agent_party || ''}</td>
						<td>&nbsp;</td>
					`;
					tbody.appendChild(tr);
				});
			} else {
				// If no agents, show one empty row
				const tr = document.createElement('tr');
				tr.innerHTML = `
					<td style="height: 0.3in;">&nbsp;</td>
					<td>&nbsp;</td>
					<td>&nbsp;</td>
				`;
				tbody.appendChild(tr);
			}
		}

		// Load data on page load
		window.addEventListener('DOMContentLoaded', loadFormData);
	</script>

</body>

</html>