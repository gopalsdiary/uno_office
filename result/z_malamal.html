<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>মালামাল গ্রহণ/হস্তান্তর ও ভাতা বিবরণী </title>
    <style>
        @font-face {
            font-family: 'NikoshBan';
            src: local('NikoshBan');
        }


        * {
            box-sizing: border-box;
        }

        body {
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
            font-family: 'NikoshBan', 'Nikosh', sans-serif;
            font-size: 11.4pt; /* increased 20% */
        }

        .legal-page {
            width: 8.5in;
            height: 14in;
            padding: 0.4in 0.5in;
            margin: 0 auto 20px auto;
            background: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            position: relative;
            page-break-after: always;
            overflow: hidden;
        }

        #loading-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            font-weight: bold;
            z-index: 1000;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 5px;
        }

        th,
        td {
            border: 1px solid black;
            padding: 2px 4px;
            vertical-align: middle;
            line-height: 1.1;
        }

        .bg-gray {
            background-color: #f2f2f2 !important;
        }

        .text-center {
            text-align: center;
        }

        .text-right {
            text-align: right;
        }

        .fw-bold {
            font-weight: bold;
        }

        p {
            margin: 0;
            padding: 0;
        }

        .summary-table {
            border-collapse: collapse;
            width: 100%;
        }

        .summary-table th,
        .summary-table td {
            border: 1px solid black !important;
            padding: 4px;
            font-size: 12pt; /* increased 20% */
        }

        @page {
            size: 8.5in 14in;
            margin: 0.1in;
        }

        @page landscape-page {
            size: 14in 8.5in;
            margin: 0.1in;
        }

        @media print {

            body,
            html {
                margin: 0 !important;
                padding: 0 !important;
                background: none !important;
            }

            .legal-page {
                box-shadow: none !important;
                margin: 0 !important;
                padding: 0.1in !important;
                width: 100% !important;
                height: 13.8in !important;
                page-break-after: always !important;
                position: relative;
                overflow: hidden !important;
            }

            .landscape-page {
                page: landscape-page !important;
                width: 13.8in !important;
                height: 8.2in !important;
            }

            /* Summary page should flow naturally across papers */
            .summary-page {
                height: auto !important;
                page-break-after: always !important;
                overflow: visible !important;
            }

            /* Detail forms should stay on one page if possible */
            .detail-page {
                height: 13.8in !important;
                overflow: hidden !important;
            }

            tr {
                page-break-inside: avoid !important;
            }

            .legal-page:last-child {
                page-break-after: auto !important;
            }

            #loading-indicator {
                display: none !important;
            }
        }

        .materials-table td {
            font-size: 10.2pt; /* increased 20% */
        }

        .allowance-table td {
            font-size: 9.6pt; /* increased 20% */
        }

        .signature-table td {
            border: none;
        }

        .page-header {
            position: relative;
            margin-top: 5px;
            padding-bottom: 28px; /* spacing to fit two stacked headings */
            text-align: center;
        }

        .page-header + p {
            margin-top: 8px; /* extra gap for readability */
        }

        /* Headings flow naturally so multiple lines stack */
        .page-header h1 {
            position: static;
            margin: 0;
            font-size: 16.8pt; /* increased 20% */
            line-height: 1.15;
            white-space: normal;
            text-align: center;
        }

        /* Slightly smaller and spaced second heading */
        .page-header h1 + h1 {
            margin-top: 6px;
            font-size: 14pt;
        }

        .centre-info {
            position: absolute;
            right: 0;
            top: 0;
            text-align: right;
            font-size: 16.8pt; /* increased 20% */
            white-space: nowrap;
        }

        .no-bold-white {
            font-weight: normal !important;
            background: white !important;
        }

        /* remove border/background for specific empty cells */
        .no-box {
            border: none !important;
            background: transparent !important;
            padding: 0 !important;
        }

        .v-top {
            vertical-align: top;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../authentication.js"></script>
</head>

<body>
    <div id="loading-indicator">উপাত্ত লোড হচ্ছে...</div>
    <div id="app"></div>

    <!-- Template for a single center -->
    <script type="text/template" id="page-template">
        <div class="legal-page detail-page">
            <div class="page-header">
                <h1><u>ত্রয়োদশ জাতীয় সংসদ নির্বাচন ও গণভোট উপলক্ষ্যে</u></h1>
                <h1><u>ভোটকেন্দ্রে ব্যবহারের জন্য প্রিজাইডিং অফিসারের অনুকূলে সরবরাহকৃত মালামালের চালান</u></h1>

                <div class="centre-info"><span>কেন্দ্র নং- </span><span style="font-weight:bold;">{{vote_centre_code}}</span></div>
            </div>
            <p align="center" style="margin: 0; padding: 0;"><font face="Nikosh">২৬৬ ফেনী-২ (ফেনী সদর উপজেলা)</font></p>

            <table width="100%" class="voter-info-table">
                <tr>
                    <td width="15%" class="bg-gray fw-bold text-center">ভোটকেন্দ্র নম্বর ও নামঃ</td>
                    <td colspan="3" width="67%"><b>{{vote_centre_code}}. {{vote_centre_name}}</b></td>
                    <td width="8%" class="bg-gray fw-bold text-center">বুথ/কক্ষঃ</td>
                    <td width="10%" class="text-center fw-bold">{{voter_both_total}}</td>
                </tr>
                <tr class="bg-gray text-center fw-bold">
                    <td width="12%">প্রিজাইডিং অফিসার</td>
                    <td width="12%">সহঃ প্রিজাইডিং অফিসার</td>
                    <td width="12%">পোলিং অফিসার</td>
                    <td width="12%">মোট হিসাব</td>
                    <td colspan="4">কেন্দ্রের ভোটার সংখ্যা (প্রযোজ্য ক্ষেত্রে ক্রমিক সহ)</td>
                </tr>
                <tr class="bg-gray text-center fw-bold" style="font-size: 9.6pt;">
                    <td rowspan="2">১</td>
                    <td rowspan="2">{{voter_both_total}}</td>
                    <td rowspan="2">{{voter_both_total_x2}}</td>
                    <td rowspan="2"><b>{{total_officer}}</b></td>
                    <td>পুরুষ ভোটার</td>
                    <td>মহিলা ভোটার</td>
                    <td>হিজড়া ভোটার</td>
                    <td>মোট</td>
                </tr>
                <tr class="text-center">
                    <td>{{male_voter}}</td>
                    <td>{{female_voter}}</td>
                    <td>{{hizra_voter}}</td>
                    <td><b>{{total_voter}}</b></td>
                </tr>
            </table>

            <table width="100%" class="top-materials-table" style="margin-top: 5px;">
                <tr>
                    <td width="3%"></td>
                    <td width="18%" class="text-center bg-gray fw-bold">বিবরণ</td>
                    <td width="18%" class="text-center bg-gray fw-bold">সংখ্যা</td>
                    <td width="74%" class="text-center bg-gray fw-bold">স্বচ্ছ ব্যালট বাক্স নম্বরঃ</td>
                </tr>
                <tr>
                    <td class="text-center">১</td>
                    <td>জাতীয় সংসদ নির্বাচনের ব্যালট পেপার</td>
                    <td class="text-center fw-bold" style="font-size: 13.2pt;">{{ballot_paper_numbers}}</td>
                    <td rowspan="5" class="text-center fw-bold" style="font-size: 16.8pt;">{{ballot_box_numbers}}</td>
                </tr>
                <tr>
                    <td class="text-center">২</td>
                    <td>গণভোট ব্যালট পেপার</td>
                    <td class="text-center fw-bold" style="font-size: 10.2pt;">{{referendum_ballot_numbers}}</td>
                </tr>
                <tr>
                    <td class="text-center">৩</td>
                    <td>ভোটার তালিকা (ছবি সহ) -সংশ্লিষ্ট এলাকার</td>
                    <td class="text-center">০১ (এক) সেট</td>
                </tr>
                <tr>
                    <td class="text-center">৪</td>
                    <td>স্বচ্ছ ব্যালট বাক্স (ঢাকনাসহ)</td>
                    <td class="text-center">{{ballot_box_qty_new}}</td>
                </tr>
                <tr>
                    <td class="text-center">৫</td>
                    <td>স্বচ্ছ ব্যালট বাক্সের সিল (লক)</td>
                    <td class="text-center">{{ballot_box_seal_qty_new}}</td>
                </tr>
            </table>

            <table width="100%" class="materials-table" style="margin-top: 5px;">
                <tr class="bg-gray text-center fw-bold">
                    <td width="3%">ক্রঃ</td>
                    <td colspan="5" width="31%">বিবরণ</td>
                    <td width="10%" colspan="2">সংখ্যা</td>
                    <td width="5%">একক</td>
                    <td width="3%">ক্রঃ</td>
                    <td colspan="8" width="40%">জাতীয় সংসদ নির্বাচনের ফরম সমূহ ও প্যাকেট সমূহ</td>
                    <td width="8%">সংখ্যা</td>
                </tr>
                <!-- Section 1: Election Materials (Left) & Forms (Right) -->
                <tr>
                    <td class="text-center">১</td>
                    <td colspan="5">অমোচনীয় কালির কলম (কক্ষ প্রতি ১টি+ কেন্দ্রে প্রতি -২টি)</td>
                    <td colspan="2" class="text-center">{{ink_qty}}</td>
                    <td class="text-center">টি</td>
                    <td class="text-center">১</td>
                    <td colspan="8">ফরম-১৩: (প্রতিকেন্দ্র -৩টি) এ ইস্যুকৃত ও ব্যবহৃত স্বচ্ছ ব্যালট বাক্সের বিবরণী</td>
                    <td class="text-center">৩ টি</td>
                </tr>
                <tr>
                    <td class="text-center">২</td>
                    <td colspan="5">রাবারের সিল মোহর (অফিসিয়াল সিল) (কক্ষ প্রতি ১টি+ কেন্দ্র প্রতি ১টি)</td>
                    <td colspan="2" class="text-center">{{rubber_seal_qty}}</td>
                    <td class="text-center">টি</td>
                    <td class="text-center">২</td>
                    <td colspan="8">ফরম-১৪: (প্রতি কেন্দ্রের জন্য-২টি) টেন্ডার্ড ভোটের তালিকা</td>
                    <td class="text-center">২ টি</td>
                </tr>
                <tr>
                    <td class="text-center">৩</td>
                    <td colspan="5">মার্কিং সিল (কক্ষ প্রতি ২টি+কেন্দ্র প্রতি-২টি)</td>
                    <td colspan="2" class="text-center">{{marking_seal_qty}}</td>
                    <td class="text-center">টি</td>
                    <td class="text-center">৩</td>
                    <td colspan="8">ফরম-১৫: (প্রতি কেন্দ্রের জন্য -৩টি) আপত্তিকৃত ভোটের তালিকা</td>
                    <td class="text-center">৩ টি</td>
                </tr>
                <tr>
                    <td class="text-center">৪</td>
                    <td colspan="5">পিতলের সিলমোহর (ব্রাস সিল) কেন্দ্র প্রতি ১টি</td>
                    <td colspan="2" class="text-center">১</td>
                    <td class="text-center">টি</td>
                    <td class="text-center">৪</td>
                    <td colspan="8">ফরম-১৬: ভোট গণনার বিবরণী ( প্রতি কেন্দ্রের জন্য ১০টি)</td>
                    <td class="text-center">১০ টি</td>
                </tr>
                <tr>
                    <td class="text-center">৫</td>
                    <td colspan="5">ষ্ট্যাম্প প্যাড (কক্ষ প্রতি ১টি+ কেন্দ্র প্রতি ১টি)</td>
                    <td colspan="2" class="text-center">{{stamp_pad_qty}}</td>
                    <td class="text-center">টি</td>
                    <td class="text-center">৫</td>
                    <td colspan="8">ফরম-১৭: (প্রতি কেন্দ্রের জন্য ৬টি) ব্যালট পেপারের হিসাবে</td>
                    <td class="text-center">৬ টি</td>
                </tr>
                <tr>
                    <td class="text-center">৬</td>
                    <td colspan="5">গালা (কেন্দ্র প্রতি ১ প্যাকেট)</td>
                    <td colspan="2" class="text-center">১</td>
                    <td class="text-center">প্যাক</td>
                    <td colspan="10" class="bg-gray text-center fw-bold">প্যাকেট সমূহ (সংসদ নির্বাচন)</td>
                </tr>
                <tr>
                    <td class="text-center">৭</td>
                    <td colspan="5">চটের থলি বড় (কেন্দ্র প্রতি ২টি)</td>
                    <td colspan="2" class="text-center">২</td>
                    <td class="text-center">টি</td>
                    <td class="text-center">১</td>
                    <td colspan="8">প্যাকেট-১: (কেন্দ্র প্রতি -১১টি) প্রার্থীদের পক্ষে প্রদত্ত বৈধ ব্যালট রাখার জন্য প্যাকেট</td>
                    <td class="text-center">১১ টি</td>
                </tr>
                <tr>
                    <td class="text-center">৮</td>
                    <td colspan="5">চটের থলি ছোট (কেন্দ্র প্রতি ১টি)</td>
                    <td colspan="2" class="text-center">১</td>
                    <td class="text-center">টি</td>
                    <td class="text-center">২</td>
                    <td colspan="8">প্যাকেট-২: (কেন্দ্র প্রতি- ২টি) গণনা থেকে বাদ দেওয়া ব্যালট পেপার সমূহ রাখার প্যাকট</td>
                    <td class="text-center">২ টি</td>
                </tr>
                <tr>
                    <td class="text-center">৯</td>
                    <td colspan="5">চার্জার লাইট-১টি, ক্যালকুলেটর-১টি, স্ট্যাপলার-১টি, পিন-১ বক্স</td>
                    <td colspan="2" class="text-center">১</td>
                    <td class="text-center">সেট</td>
                    <td class="text-center">৩</td>
                    <td colspan="8">প্যাকেট-৩: ( কেন্দ্র প্রতি ২টি) প্যাকেট-১,ও প্যাকেট-২ রাখার জন্য)</td>
                    <td class="text-center">২ টি</td>
                </tr>

                <!-- Section: Stationery (Left) & More Packets (Right) -->
                <tr class="bg-gray text-center fw-bold">
                    <td colspan="9">মনিহারী দ্রব্যাদি</td>
                    <td class="text-center no-bold-white">৪</td>
                    <td colspan="8" class="no-bold-white">প্যাকেট-৪: (কেন্দ্র প্রতি ২টি) অব্যহৃত ব্যালট পেপারসমূহ রাখার জন্য প্যাকেট</td>
                    <td class="text-center no-bold-white">২ টি</td>
                </tr>
                <tr>
                    <td class="text-center">১</td>
                    <td colspan="5">বল পয়েন্ট কলম (প্রতি কর্মকর্তা ১টি)</td>
                    <td colspan="2" class="text-center">{{ball_point_qty}}</td>
                    <td class="text-center">টি</td>
                    <td class="text-center">৫</td>
                    <td colspan="8">প্যাকেট-৫: (কেন্দ্র প্রতি-২টি) বিনষ্ট ব্যালট পেপার রাখার জন্য</td>
                    <td class="text-center">২ টি</td>
                </tr>
                <tr>
                    <td class="text-center">২</td>
                    <td colspan="5">রাবার ব্যান্ড (প্রয়োজন অনুসারে)</td>
                    <td colspan="2" class="text-center">-</td>
                    <td class="text-center">প্রয়োজনমত</td>
                    <td class="text-center">৬</td>
                    <td colspan="8">প্যাকেট-৬: (কেন্দ্র প্রতি ৩টি) টেন্ডার্ড ব্যালট পেপার রাখার জন্য</td>
                    <td class="text-center">৩ টি</td>
                </tr>
                <tr>
                    <td class="text-center">৩</td>
                    <td colspan="5">সাদা কাগজ (কেন্দ্র প্রতি আধা দিস্তা)</td>
                    <td colspan="2" class="text-center">আধা</td>
                    <td class="text-center">দিস্তা</td>
                    <td class="text-center">৭</td>
                    <td colspan="8">প্যাকেট-৭: (কেন্দ্র প্রতি ২টি) ভিন্ন ভিন্ন প্রার্থীর (প্যাকেট-৬ ) রাখার জন্য</td>
                    <td class="text-center">২ টি</td>
                </tr>
                <tr>
                    <td class="text-center">৪</td>
                    <td colspan="5">কার্বন কাগজ (কেন্দ্র প্রতি ০১ সিট)</td>
                    <td colspan="2" class="text-center">১</td>
                    <td class="text-center">সিট</td>
                    <td class="text-center">৮</td>
                    <td colspan="8">প্যাকেট-৮: (কেন্দ্র প্রতি০১টি) আপত্তিকৃত ব্যালট রাখার জন্য</td>
                    <td class="text-center">১ টি</td>
                </tr>
                <tr>
                    <td class="text-center">৫</td>
                    <td colspan="5">ছুরি (১টি) / সুই বড় (১টি)</td>
                    <td colspan="2" class="text-center">১+১</td>
                    <td class="text-center">টি</td>
                    <td class="text-center">৯</td>
                    <td colspan="8">প্যাকেট-৯: (কেন্দ্র প্রতি ২টি) চিহিৃত ভোটার তালিকা রাখার জন্য</td>
                    <td class="text-center">২ টি</td>
                </tr>
                <tr>
                    <td class="text-center">৬</td>
                    <td colspan="5">সুতার বল (কেন্দ্র প্রতি ১টি) / দিয়াশলাই (১টি)</td>
                    <td colspan="2" class="text-center">১+১</td>
                    <td class="text-center">টি</td>
                    <td class="text-center">১০</td>
                    <td colspan="8">প্যাকেট-১০: (কেন্দ্র প্রতি ২টি) ব্যবহৃত ব্যালটের মুড়ি রাখার জন্য</td>
                    <td class="text-center">২ টি</td>
                </tr>
                <tr>
                    <td class="text-center">৭</td>
                    <td colspan="5">মোমবাতি (কেন্দ্র প্রতি ৬টি)</td>
                    <td colspan="2" class="text-center">৬</td>
                    <td class="text-center">টি</td>
                    <td class="text-center">১১</td>
                    <td colspan="8">প্যাকেট-১১: (কেন্দ্র প্রতি ২টি) ভোটার তালিকা রাখার জন্য টেন্ডার</td>
                    <td class="text-center">২ টি</td>
                </tr>
                <tr>
                    <td class="text-center">৮</td>
                    <td colspan="5">গাম পট (১টি) / স্ট্যাম্প প্যাডের কালি (১ শিশি)</td>
                    <td colspan="2" class="text-center">১+১</td>
                    <td class="text-center">সেট</td>
                    <td class="text-center">১২</td>
                    <td colspan="8">প্যাকেট-১২: (কেন্দ্র প্রতি-০২টি)ইস্যুকৃত ও ব্যবহৃত স্বচ্ছ ব্যালট বাক্সের হিসাব</td>
                    <td class="text-center">২ টি</td>
                </tr>
                <tr>
                    <td class="text-center">৯</td>
                    <td colspan="5">প্লাষ্টিকের স্কেল (কক্ষ প্রতি ১টি)</td>
                    <td colspan="2" class="text-center">{{voter_both_total}}</td>
                    <td class="text-center">টি</td>
                    <td class="text-center">১৩</td>
                    <td colspan="8">প্যাকেট-১৩: (কেন্দ্র প্রতি-০২টি) আপত্তিকৃত ভোটার তালিকা রাখার প্যাকেট</td>
                    <td class="text-center">৩ টি</td>
                </tr>
                <tr>
                    <td class="text-center">১০</td>
                    <td colspan="5">সুপার গ্লু (১টি) / আলপিন</td>
                    <td colspan="2" class="text-center">১</td>
                    <td class="text-center">সেট</td>
                    <td class="text-center">১৪</td>
                    <td colspan="8">প্যাকেট-১৪: (কেন্দ্র প্রতি-২টি) ভোট গণনা হিসাব রাখার জন্য</td>
                    <td class="text-center">২ টি</td>
                </tr>
                <tr>
                    <td colspan="9" class="bg-gray text-center fw-bold">দেওয়ালপত্র</td>
                    <td class="text-center">১৫</td>
                    <td colspan="8">প্যাকেট-১৫: (কেন্দ্র প্রতি-২টি) ব্যালট পেপারের হিসাব রাখার জন্য</td>
                    <td class="text-center">৩ টি</td>
                </tr>
                <tr>
                    <td class="text-center">১</td>
                    <td colspan="6">(ক) "প্রবেশ", " বাহির", </td>
                    <td colspan="2" class="text-center">১ সেট</td>
                    <td class="text-center">১৬</td>
                    <td colspan="8">প্যাকেট-১৬: (বিবিধ কাগজপত্র রাখার প্যাকেট)</td>
                    <td class="text-center">১ টি</td>
                </tr>
                <tr>
                    <td class="text-center">২</td>
                    <td colspan="6">(খ) ভোট কক্ষ নং…………..(পুরুষ)</td>
                    <td colspan="2" class="text-center">প্রয়োজনমত</td>
                    <td class="text-center">-</td>
                    <td colspan="8">বিশেষ খামঃ(কেন্দ্র প্রতি ২টি ডাকযোগে নিকস তে ভোট গণনা প্রেরণ)</td>
                    <td class="text-center">২ টি</td>
                </tr>
                
                <!-- Section: Wall Stickers/IDs (Left) & Referendum (Right) -->
                <tr>
                    <td class="text-center">৩</td>
                    <td colspan="6">(গ) ভোট কক্ষ নং ………….(মহিলা)</td>
                    <td colspan="2" class="text-center">প্রয়োজনমত</td>
                    <td colspan="10" class="bg-gray text-center fw-bold" style="font-size: 10.2pt;">গণভোটের ফরম ও প্যাকেট সমূহ  ২ টি</td>
                </tr>
                <tr>
                    <td class="text-center">৪</td>
                    <td colspan="6">(ঘ) ভোটগ্রহণকারী কর্মকর্তা ও এজেন্টগণের দেয়ালপত্র</td>
                    <td colspan="2" class="text-center">প্রয়োজনমত</td>
                    <td class="text-center">১</td>
                    <td colspan="8">ফরম-৩ : প্রিজাইডিং অফিসার কর্তৃক ভোট গণনার বিবরণী (কেন্দ্র প্রতি)</td>
                    <td class="text-center">১০ টি</td>
                </tr>
                <tr>
                    <td colspan="9" class="bg-gray text-center fw-bold">পরিচয়পত্র</td>
                    <td class="text-center">২</td>
                    <td colspan="8">ফরম-৫ : ব্যালট পেপারের হিসাব বিবরণী (কেন্দ্র প্রতি)</td>
                    <td class="text-center">৪ টি</td>
                </tr>
                <tr>
                    <td class="text-center">১</td>
                    <td colspan="6">প্রিজাইডিং অফিসারের পরিচয়পত্র (কেন্দ্র প্রতি ১টি)</td>
                    <td colspan="2" class="text-center">১</td>
                    <td class="text-center">১</td>
                    <td colspan="8">প্যাকেট-১: "হ্যাঁ" সূচক/ 'না' সূচক বৈধ ব্যালট পেপার রাখার জন্য (কেন্দ্র প্রতি)</td>
                    <td class="text-center">২ টি</td>
                </tr>
                <tr>
                    <td class="text-center">২</td>
                    <td colspan="6">সহকারী প্রিজাইডিং অফিসারের পরিচয়পত্র (কক্ষ প্রতি ১টি)</td>
                    <td colspan="2" class="text-center">{{voter_both_total}}</td>
                    <td class="text-center">২</td>
                    <td colspan="8">প্যাকেট-২: অবৈধ বা গণনা থেকে বাদ দেওয়া ব্যালট পেপার রাখার জন্য (কেন্দ্র প্রতি)</td>
                    <td class="text-center">১ টি</td>
                </tr>
                <tr>
                    <td class="text-center">৩</td>
                    <td colspan="6">পোলিং অফিসারের পরিচয়পত্র (কক্ষ প্রতি ২টি)</td>
                    <td colspan="2" class="text-center">{{voter_both_total_x2}}</td>
                    <td class="text-center">৩</td>
                    <td colspan="8">প্যাকেট-৩: অব্যবহৃত ব্যালট পেপার রাখার জন্য (কেন্দ্র প্রতি)</td>
                    <td class="text-center">১ টি</td>
                </tr>
                <tr>
                    <td class="text-center">৪</td>
                    <td colspan="6">পোলিং এজেন্টের পরিচয়পত্র (প্রয়োজন অনুসারে)</td>
                    <td colspan="2" class="text-center">{{voter_both_total_x11}}</td>
                    <td class="text-center">৪</td>
                    <td colspan="8">প্যাকেট-৪: নষ্ট বা বাতিলকৃত ব্যালট পেপার রাখার জন্য (কেন্দ্র প্রতি)</td>
                    <td class="text-center">১ টি</td>
                </tr>
                <tr>
                    <td colspan="9" class="bg-gray text-center fw-bold">ব্যানার/ফেস্টুন</td>
                    <td class="text-center">৫</td>
                    <td colspan="8">প্যাকেট-৫: ব্যবহৃত ব্যালট পেপারের মুড়িপত্র রাখার জন্য (কেন্দ্র প্রতি)</td>
                    <td class="text-center">১ টি</td>
                </tr>
                <tr>
                    <td class="text-center">১</td>
                    <td colspan="6">ভোটকেন্দ্রের প্রবেশযোগ্য ব্যক্তি</td>
                    <td colspan="2" class="text-center">১</td>
                    <td class="text-center">৬</td>
                    <td colspan="8">প্যাকেট-৬: ফলাফল বিববরণী (ফরম-৩) রাখার জন্য (কেন্দ্র প্রতি)</td>
                    <td class="text-center">১ টি</td>
                </tr>
                <tr>
                    <td class="text-center">২</td>
                    <td colspan="6">গণভোট ফেস্টুন</td>
                    <td colspan="2" class="text-center">২</td>
                    <td class="text-center">৭</td>
                    <td colspan="8">প্যাকেট-৭: ব্যালট পেপার হিসাব বিবরণী রাখার জন্য (কেন্দ্র প্রতি)</td>
                    <td class="text-center">১ টি</td>
                </tr>
                <tr>
                    <td class="text-center">৩</td>
                    <td colspan="6">মূল্যায়ন ফরম</td>
                    <td colspan="2" class="text-center">৩</td>
                    <td colspan="9" class="no-box"></td>
                </tr>
            </table>



            <table width="100%" class="signature-table" style="margin-top: 100px;">
                <tr valign="top" class="text-center">
                    <td width="45%">
                        <p style="border-top: 1px solid black; display: inline-block; width: 180px; padding-top: 5px;"><b>প্রিজাইডিং অফিসারের স্বাক্ষর</b></p>
                    </td>
                    <td width="10%"></td>
                    <td width="45%">
                        <p style="border-top: 1px solid black; display: inline-block; width: 220px; padding-top: 5px;"><b>রিটার্নিং/সহকারী রিটার্নিং অফিসারের স্বাক্ষর</b></p>
                    </td>
                </tr>
            </table>
        </div>
    </script>



    <script id="serial-summary-template" type="text/template">
        <div class="legal-page summary-page" style="height: auto; min-height: 14in;">
            <h2 class="text-center" style="margin-top: 0; margin-bottom: 20px; text-decoration: underline;">কেন্দ্র ভিত্তিক ভোটার ক্রমিক (ব্যালট বাক্স নম্বর) সংক্ষপ্তি তালিকা</h2>
            <table width="100%" class="summary-table">
                <thead>
                    <tr class="bg-gray text-center fw-bold">
                        <td width="5%">ক্রঃ</td>
                        <td width="10%">কেন্দ্র কোড</td>
                        <td width="35%">কেন্দ্রের নাম</td>
                        <td width="15%">মোট ভোটার</td>
                        <td width="35%">ব্যালট পেপার ক্রমিক</td>
                    </tr>
                </thead>
                <tbody>
                    {{rows}}
                </tbody>
            </table>

            <table width="100%" class="signature-table" style="margin-top: 100px; border: none;">
                <tr valign="top" class="text-center" style="border: none;">
                    <td width="45%" style="border: none;">
                        <p style="border-top: 1px solid black; display: inline-block; width: 180px; padding-top: 5px;"><b>অফিস সহকারী/আইটি</b></p>
                    </td>
                    <td width="10%" style="border: none;"></td>
                    <td width="45%" style="border: none;">
                        <p style="border-top: 1px solid black; display: inline-block; width: 220px; padding-top: 5px;"><b>রিটার্নিং/সহকারী রিটার্নিং অফিসার</b></p>
                    </td>
                </tr>
            </table>
        </div>
    </script>

    <script>
        const App = {
            config: { presiding: 8000, assistant: 6000, polling: 4000, travel: 1000, bestni: 800, tax: 0.1, vat: 0.18, rev: 390 },
            bn: ['০', '১', '২', '৩', '৪', '৫', '৬', '৭', '৮', '৯'],

            padZero(n, len) { return String(n).padStart(len, '0'); },
            toBn(n) { return n === null || n === undefined ? '' : String(n).replace(/\d/g, d => this.bn[+d]); },
            toEn(s) { const m = { '০': '0', '১': '1', '২': '2', '৩': '3', '৪': '4', '৫': '5', '৬': '6', '৭': '7', '৮': '8', '৯': '9' }; return String(s).replace(/[০-৯]/g, x => m[x]); },

            async init() {
                const p = new URLSearchParams(window.location.search);
                const c = p.get('vote_centre_code');
                try {
                    // Fetch centers and presiding assignments separately
                    const [centersRes, assignmentsRes] = await Promise.all([
                        window.supabaseClient.from('vote_centre').select('*').order('vote_centre_code', { ascending: true }),
                        window.supabaseClient.from('centre_assignments').select('vote_centre_code, officer_name, officer_type').eq('officer_type', 'presiding')
                    ]);

                    if (centersRes.error) throw centersRes.error;
                    if (assignmentsRes.error) throw assignmentsRes.error;

                    const data = centersRes.data;
                    const assignments = assignmentsRes.data;

                    const container = document.getElementById('app');

                    // Cumulative Voter Serial calculation for ALL centers
                    let currentSerial = 1;
                    
                    // Referendum ranges logic
                    let refRange1 = { start: 1, end: 134331, current: 1 };
                    let refRange2 = { start: 1710001, end: 2000000, current: 1710001 };

                    const centersWithRange = data.map(d => {
                        const voterCount = parseInt(this.toEn(d.total_voter || 0));
                        
                        // Normal Ballot Paper Serial
                        const start = currentSerial;
                        const end = currentSerial + voterCount - 1;
                        currentSerial = end + 1;

                        // Referendum Ballot Paper Serial calculation
                        let refParts = [];
                        let tempCount = voterCount;

                        // Use Range 1 if available
                        if (refRange1.current <= refRange1.end) {
                            let available = refRange1.end - refRange1.current + 1;
                            let usable = Math.min(tempCount, available);
                            let rStart = refRange1.current;
                            let rEnd = refRange1.current + usable - 1;
                            refParts.push(this.toBn(this.padZero(rStart, 7)) + ' - ' + this.toBn(this.padZero(rEnd, 7)));
                            refRange1.current += usable;
                            tempCount -= usable;
                        }

                        // Use Range 2 if still need more
                        if (tempCount > 0 && refRange2.current <= refRange2.end) {
                            let available = refRange2.end - refRange2.current + 1;
                            let usable = Math.min(tempCount, available);
                            let rStart = refRange2.current;
                            let rEnd = refRange2.current + usable - 1;
                            refParts.push(this.toBn(this.padZero(rStart, 7)) + ' - ' + this.toBn(this.padZero(rEnd, 7)));
                            refRange2.current += usable;
                            tempCount -= usable;
                        }

                        // Find presiding officer for this centre code
                        const presiding = assignments.find(a => String(a.vote_centre_code) === String(d.vote_centre_code));

                        return {
                            ...d,
                            startSerial: start,
                            endSerial: end,
                            referendumSerial: refParts.join(' ; '),
                            centre_assignments: presiding ? [presiding] : []
                        };
                    });

                    const filtered = c ? centersWithRange.filter(d => d.vote_centre_code == c) : centersWithRange;

                    // 2. Serial Summary Logic (Portrait)
                    if (filtered.length > 1) {
                        let serialRowsHtml = '';
                        filtered.forEach((d, idx) => {
                            serialRowsHtml += `
                                <tr>
                                    <td class="text-center">${this.toBn(idx + 1)}</td>
                                    <td class="text-center">${this.toBn(d.vote_centre_code)}</td>
                                    <td>${d.vote_centre_name}</td>
                                    <td class="text-center">${this.toBn(d.total_voter)}</td>
                                    <td class="text-center fw-bold" style="font-size: 13.2pt;">${this.toBn(d.startSerial)} - ${this.toBn(d.endSerial)}</td>
                                </tr>
                            `;
                        });
                        let serialTmp = document.getElementById('serial-summary-template').innerHTML;
                        serialTmp = serialTmp.replace('{{rows}}', serialRowsHtml);
                        const serialEl = document.createElement('div');
                        serialEl.innerHTML = serialTmp;
                        container.appendChild(serialEl.firstElementChild);
                    }

                    // Individual Pages
                    filtered.forEach(d => {
                        const page = this.render(d);
                        container.appendChild(page);
                    });

                    document.getElementById('loading-indicator').style.display = 'none';
                } catch (e) {
                    console.error(e);
                    document.getElementById('loading-indicator').textContent = "ত্রুটি ঘটেছে!";
                }
            },

            calculate(data) {
                const totalVoter = parseInt(this.toEn(data.total_voter || 0));
                const voterBothTotal = parseInt(this.toEn(data.voter_both_total)) || Math.ceil(totalVoter / 1200);
                const totalOfficer = 1 + voterBothTotal + (voterBothTotal * 2);

                const presidingTotal = 8000;
                const assistantTotal = voterBothTotal * 6000;
                const pollingTotal = (voterBothTotal * 2) * 4000;
                const honorariumTotal = presidingTotal + assistantTotal + pollingTotal;

                const travelTotal = totalOfficer * 1000;
                const bestniTotal = voterBothTotal * 1200;
                const monihariTotal = 1500;

                const grossTotal = honorariumTotal + travelTotal + bestniTotal + monihariTotal;

                // Tax 10% on items 1, 2, 3, 4 (Honorarium + Travel)
                const tax10 = Math.round((honorariumTotal + travelTotal) * 0.10);
                // Beshtoni VAT 5% + IT 10% = 15%
                const vatIt = Math.round(bestniTotal * 0.15);
                const revenue = 30 + (totalOfficer - 1) * 20;

                const totalDeduction = tax10 + vatIt + revenue;
                const netTotal = grossTotal - totalDeduction;

                return {
                    gross: grossTotal,
                    deduction: totalDeduction,
                    net: netTotal,
                    vbt: voterBothTotal,
                    voter: totalVoter,
                    officer: totalOfficer,
                    assistantTotal,
                    pollingTotal,
                    travelTotal,
                    bestniTotal,
                    monihariTotal,
                    tax10,
                    vatIt,
                    revenue
                };
            },

            render(d) {
                const res = this.calculate(d);
                const voterBothTotal = res.vbt;
                const totalVoter = res.voter;
                const totalOfficer = res.officer;

                // Material Quantities
                const ballotBoxQty = Math.ceil(totalVoter / 400); // 400 voters per box
                const ballotBoxSealQty = ballotBoxQty * 3;
                const inkQty = voterBothTotal + 2;
                const rubberSealQty = voterBothTotal + 1;
                const markingSealQty = (voterBothTotal * 2) + 2;
                const stampPadQty = voterBothTotal + 1;

                const presidingName = d.centre_assignments?.find(a => a.officer_type === 'presiding')?.officer_name || '';

                const vals = {
                    vote_centre_code: this.toBn(d.vote_centre_code),
                    vote_centre_name: d.vote_centre_name,
                    presiding_name: presidingName,
                    voter_both_total: this.toBn(voterBothTotal),
                    voter_both_total_x2: this.toBn(voterBothTotal * 2),
                    voter_both_total_x11: this.toBn(voterBothTotal * 11),
                    male_voter: this.toBn(d.male_voter || 0),
                    female_voter: this.toBn(d.female_voter || 0),
                    hizra_voter: this.toBn(d.hizra_voter || 0),
                    total_voter: this.toBn(totalVoter),
                    total_officer: this.toBn(totalOfficer),
                    ballot_box_qty: this.toBn(ballotBoxQty),
                    ballot_box_seal_qty: this.toBn(ballotBoxSealQty),
                    ballot_box_qty_new: this.toBn(voterBothTotal + 2),
                    ballot_box_seal_qty_new: this.toBn((voterBothTotal + 2) * 5),
                    ballot_paper_numbers: this.toBn(this.padZero(d.startSerial, 7)) + ' - ' + this.toBn(this.padZero(d.endSerial, 7)),
                    referendum_ballot_numbers: d.referendumSerial,
                    ballot_box_numbers: '',
                    ink_qty: this.toBn(inkQty),
                    rubber_seal_qty: this.toBn(rubberSealQty),
                    marking_seal_qty: this.toBn(markingSealQty),
                    stamp_pad_qty: this.toBn(stampPadQty),
                    ball_point_qty: this.toBn(totalOfficer),
                    assistant_total: this.toBn(res.assistantTotal.toLocaleString('bn-BD')),
                    polling_total: this.toBn(res.pollingTotal.toLocaleString('bn-BD')),
                    travel_total: this.toBn(res.travelTotal.toLocaleString('bn-BD')),
                    bestni_total: this.toBn(res.bestniTotal.toLocaleString('bn-BD')),
                    monihari_total: this.toBn(res.monihariTotal.toLocaleString('bn-BD')),
                    gross_total: this.toBn(res.gross.toLocaleString('bn-BD')),
                    tax_10: this.toBn(res.tax10.toLocaleString('bn-BD')),
                    vat_it: this.toBn(res.vatIt.toLocaleString('bn-BD')),
                    revenue: this.toBn(res.revenue.toLocaleString('bn-BD')),
                    net_total: this.toBn(res.net.toLocaleString('bn-BD')),
                    total_deduction: this.toBn(res.deduction.toLocaleString('bn-BD'))
                };

                let h = document.getElementById('page-template').innerHTML;
                for (let key in vals) {
                    h = h.replace(new RegExp(`{{${key}}}`, 'g'), vals[key] === undefined || vals[key] === null ? '' : vals[key]);
                }
                const el = document.createElement('div'); el.innerHTML = h; return el.firstElementChild;
            },


        };
        document.addEventListener('DOMContentLoaded', () => App.init());
    </script>
</body>

</html>