<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>মালামাল গ্রহণ/হস্তান্তর ও ভাতা বিবরণী (Z-Copy)</title>
    <style>
        @font-face {
            font-family: 'NikoshBan';
            src: local('NikoshBan');
        }

        @page {
            size: 8.5in 14in;
            margin: 0.3in;
        }

        * {
            box-sizing: border-box;
        }

        body {
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
            font-family: 'NikoshBan', 'Nikosh', sans-serif;
            font-size: 9.5pt;
        }

        .legal-page {
            width: 8.5in;
            min-height: 14in;
            padding: 0.3in;
            margin: 0 auto 20px auto;
            background: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            position: relative;
            page-break-after: always;
        }

        #loading-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            font-weight: bold;
            z-index: 1000;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 5px;
        }

        th,
        td {
            border: 1px solid black;
            padding: 2px 4px;
            vertical-align: middle;
            line-height: 1.1;
        }

        .bg-gray {
            background-color: #f2f2f2 !important;
        }

        .text-center {
            text-align: center;
        }

        .text-right {
            text-align: right;
        }

        .fw-bold {
            font-weight: bold;
        }

        p {
            margin: 0;
            padding: 0;
        }

        @media print {
            body {
                background: none;
                padding: 0;
            }

            .legal-page {
                box-shadow: none;
                margin: 0;
                padding: 0.15in 0.3in;
                width: 100%;
                height: 100%;
            }

            #loading-indicator {
                display: none;
            }
        }

        .materials-table td {
            font-size: 8.5pt;
        }

        .allowance-table td {
            font-size: 8pt;
        }

        .signature-table td {
            border: none;
        }

        .v-top {
            vertical-align: top;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../authentication.js"></script>
</head>

<body>
    <div id="loading-indicator">উপাত্ত লোড হচ্ছে...</div>
    <div id="app"></div>

    <!-- Template for a single center -->
    <script type="text/template" id="page-template">
        <div class="legal-page">
            <p align="right" style="margin: 0; padding: 0;">
                <font face="Nikosh">কেন্দ্র নং- {{vote_centre_code}}</font>
            </p>
            <p align="center" style="margin: 0; padding: 0;"><font face="Nikosh"><font size="4">ত্রয়োদশ জাতীয় সংসদ নির্বাচন ও গণভোট-২০২৬</font></font></p>
            <p align="center" style="margin: 0; padding: 0;"><font face="Nikosh">২৬৬ ফেনী-২ (ফেনী সদর উপজেলা)</font></p>
            <p align="center" style="margin-bottom: 5px; padding: 0;"><font face="Nikosh"><b>প্রিজাইডিং অফিসারের নিকট নির্বাচনী দ্রব্যাদি সরবরাহ এবং ভাতা প্রদানের হিসাব বিবরণী</b></font></p>

            <table width="100%" class="voter-info-table">
                <tr>
                    <td width="15%" class="bg-gray fw-bold text-center">ভোটকেন্দ্র নম্বর ও নামঃ</td>
                    <td colspan="3" width="67%"><b>{{vote_centre_code}}. {{vote_centre_name}}</b></td>
                    <td width="8%" class="bg-gray fw-bold text-center">কক্ষঃ</td>
                    <td width="10%" class="text-center fw-bold">{{voter_both_total}}</td>
                </tr>
                <tr class="bg-gray text-center fw-bold">
                    <td width="12%">প্রিজাইডিং অফিসার</td>
                    <td width="12%">সহঃ প্রিজাইডিং অফিসার</td>
                    <td width="12%">পোলিং অফিসার</td>
                    <td width="12%">মোট হিসাব</td>
                    <td colspan="4">কেন্দ্রের ভোটার সংখ্যা (প্রযোজ্য ক্ষেত্রে ক্রমিক সহ)</td>
                </tr>
                <tr class="bg-gray text-center fw-bold" style="font-size: 8pt;">
                    <td rowspan="2">১</td>
                    <td rowspan="2">{{voter_both_total}}</td>
                    <td rowspan="2">{{voter_both_total_x2}}</td>
                    <td rowspan="2"><b>{{total_officer}}</b></td>
                    <td>পুরুষ ভোটার</td>
                    <td>মহিলা ভোটার</td>
                    <td>হিজড়া ভোটার</td>
                    <td>মোট</td>
                </tr>
                <tr class="text-center">
                    <td>{{male_voter}}</td>
                    <td>{{female_voter}}</td>
                    <td>{{hizra_voter}}</td>
                    <td><b>{{total_voter}}</b></td>
                </tr>
            </table>

            <table width="100%" class="materials-table" style="margin-top: 5px;">
                <tr class="bg-gray text-center fw-bold">
                    <td width="3%">ক্রঃ</td>
                    <td colspan="5" width="28%">বিবরণ</td>
                    <td colspan="3" width="19%">সংখ্যা</td>
                    <td colspan="10" width="50%">স্বচ্ছ ব্যালট বাক্স নম্বরঃ</td>
                </tr>
                <tr>
                    <td class="text-center">১</td>
                    <td colspan="5">ব্যালট পেপার (সংসদ)</td>
                    <td colspan="3" class="text-center">{{total_voter}}</td>
                    <td rowspan="5" colspan="10"></td>
                </tr>
                <tr>
                    <td class="text-center">২</td>
                    <td colspan="5">গণভোট ব্যালট পেপার</td>
                    <td colspan="3" class="text-center">{{total_voter}}</td>
                </tr>
                <tr>
                    <td class="text-center">৩</td>
                    <td colspan="5">ভোটার তালিকা (ছবি সহ) - সংশ্লিষ্ট এলাকার</td>
                    <td colspan="3" class="text-center">০১ (এক) সেট</td>
                </tr>
                <tr>
                    <td class="text-center">৪</td>
                    <td colspan="5">স্বচ্ছ ব্যালট বাক্স (ঢাকনাসহ)</td>
                    <td colspan="3" class="text-center"><b>{{ballot_box_qty}}</b></td>
                </tr>
                <tr>
                    <td class="text-center">৫</td>
                    <td colspan="5">স্বচ্ছ ব্যালট বাক্সের সিল (লক)</td>
                    <td colspan="3" class="text-center"><b>{{ballot_box_seal_qty}}</b></td>
                </tr>
                
                <tr class="bg-gray text-center fw-bold">
                    <td width="3%">ক্রঃ</td>
                    <td colspan="5" width="31%">নির্বাচনি দ্রব্যাদি</td>
                    <td width="10%" colspan="2">পরিমাণ</td>
                    <td width="4%">একক</td>
                    <td width="3%">ক্রঃ</td>
                    <td colspan="8" width="40%">ফরম সমূহ</td>
                    <td width="8%">সংখ্যা</td>
                </tr>
                <tr>
                    <td class="text-center">১</td>
                    <td colspan="5">অমোচনীয় কালির কলম</td>
                    <td colspan="2" class="text-center">{{ink_qty}}</td>
                    <td class="text-center">টি</td>
                    <td class="text-center">১</td>
                    <td colspan="8">ফরম-১৩: ইস্যুকৃত ও ব্যবহৃত ব্যালট বাক্সের বিবরণী</td>
                    <td class="text-center">৪ টি</td>
                </tr>
                <tr>
                    <td class="text-center">২</td>
                    <td colspan="5">রাবারের সিল মোহর (অফিসিয়াল সিল)</td>
                    <td colspan="2" class="text-center">{{rubber_seal_qty}}</td>
                    <td class="text-center">টি</td>
                    <td class="text-center">২</td>
                    <td colspan="8">ফরম-১৪: টেন্ডার্ড ভোটের তালিকা</td>
                    <td class="text-center">৩ টি</td>
                </tr>
                <tr>
                    <td class="text-center">৩</td>
                    <td colspan="5">মার্কিং সিল</td>
                    <td colspan="2" class="text-center">{{marking_seal_qty}}</td>
                    <td class="text-center">টি</td>
                    <td class="text-center">৩</td>
                    <td colspan="8">ফরম-১৫: আপত্তিকৃত ভোটের তালিকা</td>
                    <td class="text-center">৫ টি</td>
                </tr>
                <tr>
                    <td class="text-center">৪</td>
                    <td colspan="5">পিতলের সিলমোহর (ব্রাস সিল)</td>
                    <td colspan="2" class="text-center">১</td>
                    <td class="text-center">টি</td>
                    <td class="text-center">৪</td>
                    <td colspan="8">ফরম-১৬: ভোট গণনার বিবরণী</td>
                    <td class="text-center">১৩ টি</td>
                </tr>
                <tr>
                    <td class="text-center">৫</td>
                    <td colspan="5">ষ্ট্যাম্প প্যাড (কালিসহ)</td>
                    <td colspan="2" class="text-center">{{stamp_pad_qty}}</td>
                    <td class="text-center">টি</td>
                    <td class="text-center">৫</td>
                    <td colspan="8">ফরম-১৭: ব্যালট পেপার হিসাব</td>
                    <td class="text-center">৮ টি</td>
                </tr>
                <tr>
                    <td class="text-center">৬</td>
                    <td colspan="5">গালা (প্যাকেট)</td>
                    <td colspan="2" class="text-center">১</td>
                    <td class="text-center">প্যাক</td>
                    <td colspan="10" class="bg-gray text-center fw-bold">প্যাকেট সমূহ</td>
                </tr>
                <tr>
                    <td class="text-center">৭</td>
                    <td colspan="5">চটের থলি বড় (কেন্দ্র প্রতি ২টি)</td>
                    <td colspan="2" class="text-center">২</td>
                    <td class="text-center">টি</td>
                    <td class="text-center">১</td>
                    <td colspan="8">প্যাকেট-১, ২ ও ৩ (বৈধ, বাতিল ও সংরক্ষিত)</td>
                    <td class="text-center">সকল</td>
                </tr>
                <tr>
                    <td class="text-center">৮</td>
                    <td colspan="5">চটের থলি ছোট (কেন্দ্র প্রতি ১টি)</td>
                    <td colspan="2" class="text-center">১</td>
                    <td class="text-center">টি</td>
                    <td class="text-center">২</td>
                    <td colspan="8">প্যাকেট-৪ ও ৫ (অব্যবহৃত ও বিনষ্ট)</td>
                    <td class="text-center">সকল</td>
                </tr>
                <tr>
                    <td class="text-center">৯</td>
                    <td colspan="5">চার্জার লাইট/ক্যালকুলেটর/ষ্ট্যাপলার/পিন</td>
                    <td colspan="2" class="text-center">১/১/১/১</td>
                    <td class="text-center">সেট</td>
                    <td class="text-center">৩</td>
                    <td colspan="8">প্যাকেট-৯ ও ১০ (ভোটার তালিকা ও মুড়িপত্র)</td>
                    <td class="text-center">সকল</td>
                </tr>
                
                <tr class="bg-gray text-center fw-bold">
                    <td width="3%">ক্রঃ</td>
                    <td colspan="5" width="31%">মনিহারী দ্রব্যাদি</td>
                    <td width="10%" colspan="2">পরিমাণ</td>
                    <td width="4%">একক</td>
                    <td width="3%">ক্রঃ</td>
                    <td colspan="8" width="40%">গণভোটের জন্য ব্যবহৃত ফরম ও প্যাকেট</td>
                    <td width="8%">সংখ্যা</td>
                </tr>
                <tr>
                    <td class="text-center">১</td>
                    <td colspan="5">বল পয়েন্ট কলম (প্রতি কর্মকর্তা ১টি)</td>
                    <td colspan="2" class="text-center">{{ball_point_qty}}</td>
                    <td class="text-center">টি</td>
                    <td class="text-center">১</td>
                    <td colspan="8">ফরম-৩ ও ৫ (গণনা ও ব্যালট হিসাব)</td>
                    <td class="text-center">প্রয়োজন</td>
                </tr>
                <tr>
                    <td class="text-center">২</td>
                    <td colspan="5">রাবার ব্যান্ড / আলপিন</td>
                    <td colspan="2" class="text-center">-</td>
                    <td class="text-center">প্রয়োজন</td>
                    <td class="text-center">২</td>
                    <td colspan="8">প্যাকেট-১ থেকে ৪ (বৈধ, অবৈধ ও অব্যবহৃত)</td>
                    <td class="text-center">সকল</td>
                </tr>
                <tr>
                    <td class="text-center">৩</td>
                    <td colspan="5">সাদা কাগজ / কার্বন কাগজ / স্কেল</td>
                    <td colspan="2" class="text-center">-</td>
                    <td class="text-center">সেট</td>
                    <td class="text-center">৩</td>
                    <td colspan="8">প্যাকেট-৫ থেকে ৭ (মুড়িপত্র ও অন্যান্য)</td>
                    <td class="text-center">সকল</td>
                </tr>
                <tr>
                    <td class="text-center">৪</td>
                    <td colspan="5">মোমবাতি (৬টি) / দিয়াশলাই (১টি)</td>
                    <td colspan="2" class="text-center">১</td>
                    <td class="text-center">সেট</td>
                    <td rowspan="4" class="text-center">৪</td>
                    <td rowspan="4" colspan="8">বিশেষ খাম (নিকস ও ডাকযোগের জন্য)</td>
                    <td rowspan="4" class="text-center">২ টি</td>
                </tr>
                <tr>
                    <td class="text-center">৫</td>
                    <td colspan="5">গাম পট / সুপার গ্লু / ছুরি / সুই-সুতা</td>
                    <td colspan="2" class="text-center">১</td>
                    <td class="text-center">সেট</td>
                </tr>
                <tr>
                    <td class="text-center">৬</td>
                    <td colspan="5">প্লাস্টিকের স্কেল (কক্ষ প্রতি ১টি)</td>
                    <td colspan="2" class="text-center">{{voter_both_total}}</td>
                    <td class="text-center">টি</td>
                </tr>
                <tr>
                    <td class="text-center">৭</td>
                    <td colspan="5">সুতার বল (প্রতি কেন্দ্র ১টি)</td>
                    <td colspan="2" class="text-center">১</td>
                    <td class="text-center">টি</td>
                </tr>
                
                <tr class="bg-gray text-center fw-bold">
                    <td colspan="9">দেওয়ালপত্র</td>
                    <td colspan="10">পরিচয়পত্র</td>
                </tr>
                <tr>
                    <td class="text-center">১</td>
                    <td colspan="6">(ক) "প্রবেশ", (খ) "বাহির"</td>
                    <td colspan="2" class="text-center">১ সেট</td>
                    <td class="text-center">১</td>
                    <td colspan="7">প্রিজাইডিং অফিসার আইডি</td>
                    <td class="text-center">১ টি</td>
                </tr>
                <tr>
                    <td class="text-center">২</td>
                    <td colspan="6">(গ) ভোট কক্ষ নং (পুরুষ/মহিলা)</td>
                    <td colspan="2" class="text-center">প্রয়োজন</td>
                    <td class="text-center">২</td>
                    <td colspan="7">সহকারী প্রিজাইডিং অফিসার আইডি</td>
                    <td class="text-center">{{voter_both_total}} টি</td>
                </tr>
                <tr>
                    <td class="text-center">৩</td>
                    <td colspan="6">(ঘ) ভোটগ্রহণকারী কর্মকর্তা ও এজেন্টগণের দেয়ালপত্র</td>
                    <td colspan="2" class="text-center">প্রয়োজন</td>
                    <td class="text-center">৩</td>
                    <td colspan="7">পোলিং অফিসার আইডি</td>
                    <td class="text-center">{{voter_both_total_x2}} টি</td>
                </tr>
                <tr>
                    <td colspan="9" rowspan="1"></td>
                    <td class="text-center">৪</td>
                    <td colspan="7">পোলিং এজেন্ট আইডি</td>
                    <td class="text-center">প্রয়োজন</td>
                </tr>
            </table>

            <table width="100%" class="allowance-table" style="margin-top: 5px;">
                <tr class="bg-gray text-center fw-bold">
                    <td colspan="11">ভোটগ্রহণকারী কর্মকর্তাদের ভাতা প্রদানের হিসাব বিবরণী</td>
                </tr>
                <tr class="bg-gray text-center fw-bold" style="font-size: 8pt;">
                    <td width="10%">প্রিজাইডিং অফিসার (৮০০০*১)</td>
                    <td width="10%">সহকারী প্রিজাইডিং (৬০০০*১)</td>
                    <td width="10%">পোলিং অফিসার (৪০০০*১)</td>
                    <td width="10%">যাতায়াত ভাতা (১০০০/- হারে)</td>
                    <td width="10%">বেষ্টনি নির্মাণ (৮০০/- হারে)</td>
                    <td width="10%">মোট টাকার পরিমাণ</td>
                    <td width="8%">উৎস কর কর্তন (১০%)</td>
                    <td width="10%">বেষ্টনী ভ্যাট-আইটি (১৮%)</td>
                    <td width="8%">রেভিনিউ</td>
                    <td width="14%">নিট পাওনা (মোট প্রদত্ত টাকা)</td>
                </tr>
                <tr class="text-center fw-bold">
                    <td>৮,০০০</td>
                    <td>{{assistant_total}}</td>
                    <td>{{polling_total}}</td>
                    <td>{{travel_total}}</td>
                    <td>{{bestni_total}}</td>
                    <td>{{gross_total}}</td>
                    <td>{{tax_10}}</td>
                    <td>{{vat_it}}</td>
                    <td>{{revenue}}</td>
                    <td style="background:#e9f7ef; font-size: 11pt;">{{net_total}}</td>
                </tr>
                <tr>
                    <td colspan="6" class="text-right fw-bold">মোট কর্তন:</td>
                    <td colspan="5" class="text-center fw-bold bg-gray">{{total_deduction}}</td>
                </tr>
            </table>

            <table width="100%" class="signature-table" style="margin-top: 15px;">
                <tr valign="top" class="text-center">
                    <td width="45%">
                        <p style="border-top: 1px solid black; display: inline-block; width: 180px; padding-top: 5px;"><b>প্রিজাইডিং অফিসারের স্বাক্ষর</b></p>
                    </td>
                    <td width="10%"></td>
                    <td width="45%">
                        <p style="border-top: 1px solid black; display: inline-block; width: 220px; padding-top: 5px;"><b>রিটার্নিং/সহকারী রিটার্নিং অফিসারের স্বাক্ষর</b></p>
                    </td>
                </tr>
            </table>
        </div>
    </script>

    <script>
        const App = {
            config: { presiding: 8000, assistant: 6000, polling: 4000, travel: 1000, bestni: 800, tax: 0.1, vat: 0.18, rev: 390 },
            bn: ['০', '১', '২', '৩', '৪', '৫', '৬', '৭', '৮', '৯'],

            toBn(n) { return n === null ? '' : String(n).replace(/\d/g, d => this.bn[+d]); },
            toEn(s) { const m = { '০': '0', '১': '1', '২': '2', '৩': '3', '৪': '4', '৫': '5', '৬': '6', '৭': '7', '৮': '8', '৯': '9' }; return String(s).replace(/[০-৯]/g, x => m[x]); },

            async init() {
                const p = new URLSearchParams(window.location.search);
                const c = p.get('vote_centre_code');
                try {
                    const { data, error } = await window.supabaseClient.from('vote_centre').select('*').order('vote_centre_code', { ascending: true });
                    if (error) throw error;

                    const container = document.getElementById('app');
                    const filtered = c ? data.filter(d => d.vote_centre_code == c) : data;

                    filtered.forEach(d => {
                        const page = this.render(d);
                        container.appendChild(page);
                    });

                    document.getElementById('loading-indicator').style.display = 'none';
                } catch (e) {
                    console.error(e);
                    document.getElementById('loading-indicator').textContent = "ত্রুটি ঘটেছে!";
                }
            },

            render(d) {
                const data = d; // Use 'd' as 'data' for consistency with the provided snippet
                const totalVoter = parseInt(this.toEn(data.total_voter || 0));
                const voterBothTotal = parseInt(this.toEn(data.voter_both_total)) || Math.ceil(totalVoter / 1200);
                const totalOfficer = 1 + voterBothTotal + (voterBothTotal * 2);

                // Material Quantities
                const ballotBoxQty = Math.ceil(totalVoter / 400); // 400 voters per box
                const ballotBoxSealQty = ballotBoxQty * 3;
                const inkQty = Math.ceil(voterBothTotal / 2) + 2;
                const rubberSealQty = Math.ceil(voterBothTotal / 2) + 1;
                const markingSealQty = voterBothTotal * 2 + 2;
                const stampPadQty = Math.ceil(voterBothTotal / 2) + 1;

                // Allowance Calculations
                const presidingTotal = 8000;
                const assistantTotal = voterBothTotal * 6000;
                const pollingTotal = (voterBothTotal * 2) * 4000;
                const honorariumTotal = presidingTotal + assistantTotal + pollingTotal;

                const travelTotal = totalOfficer * 1000;
                const bestniTotal = voterBothTotal * 800; // 800 per booth

                const grossTotal = honorariumTotal + travelTotal + bestniTotal;

                const tax10 = Math.round(honorariumTotal * 0.10);
                const vatIt = Math.round(bestniTotal * 0.18);
                const revenue = 30 + (totalOfficer - 1) * 20;

                const totalDeduction = tax10 + vatIt + revenue;
                const netTotal = grossTotal - totalDeduction;

                const vals = {
                    vote_centre_code: this.toBn(data.vote_centre_code),
                    vote_centre_name: data.vote_centre_name,
                    voter_both_total: this.toBn(voterBothTotal),
                    voter_both_total_x2: this.toBn(voterBothTotal * 2),
                    male_voter: this.toBn(data.male_voter || 0),
                    female_voter: this.toBn(data.female_voter || 0),
                    hizra_voter: this.toBn(data.hizra_voter || 0),
                    total_voter: this.toBn(totalVoter),
                    total_officer: this.toBn(totalOfficer),
                    ballot_box_qty: this.toBn(ballotBoxQty),
                    ballot_box_seal_qty: this.toBn(ballotBoxSealQty),
                    ink_qty: this.toBn(inkQty),
                    rubber_seal_qty: this.toBn(rubberSealQty),
                    marking_seal_qty: this.toBn(markingSealQty),
                    stamp_pad_qty: this.toBn(stampPadQty),
                    ball_point_qty: this.toBn(totalOfficer),
                    assistant_total: this.toBn(assistantTotal.toLocaleString('bn-BD')),
                    polling_total: this.toBn(pollingTotal.toLocaleString('bn-BD')),
                    travel_total: this.toBn(travelTotal.toLocaleString('bn-BD')),
                    bestni_total: this.toBn(bestniTotal.toLocaleString('bn-BD')),
                    gross_total: this.toBn(grossTotal.toLocaleString('bn-BD')),
                    tax_10: this.toBn(tax10.toLocaleString('bn-BD')),
                    vat_it: this.toBn(vatIt.toLocaleString('bn-BD')),
                    revenue: this.toBn(revenue.toLocaleString('bn-BD')),
                    net_total: this.toBn(netTotal.toLocaleString('bn-BD')),
                    total_deduction: this.toBn(totalDeduction.toLocaleString('bn-BD'))
                };

                let h = document.getElementById('page-template').innerHTML;
                for (let key in vals) {
                    h = h.replace(new RegExp(`{{${key}}}`, 'g'), vals[key] || '');
                }
                const el = document.createElement('div'); el.innerHTML = h; return el.firstElementChild;
            },


        };
        document.addEventListener('DOMContentLoaded', () => App.init());
    </script>
</body>

</html>