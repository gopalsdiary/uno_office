where > table public.vote_centre (
  vote_centre_iid bigint generated by default as identity not null,
  vote_centre_code numeric null,
  vote_centre_name text null,
  voter_both_total numeric null,
  voter_both_male numeric null,
  voter_both_female numeric null,
  vote_centre_location text null,
  vote_centre_area text null,
  male_voter text null,
  female_voter text null,
  hizra_voter text null,
  total_voter text null,
  vote_centre_quality text null,
  comment text null,
  vote_centre_condition text null,
  constraint vote_centre_pkey primary key (vote_centre_iid),
  constraint vote_centre_vote_centre_iid_key unique (vote_centre_iid)
) TABLESPACE pg_default;


where table public.presiding_list (
  presiding_iid bigint generated by default as identity not null,
  presiding_name text null,
  mobile_number text null,
  sallery_scale text null,
  current_grade_sallery text null,
  date_of_birth text null,
  own_discrict text null,
  address text null,
  "Nid_number" text null,
  previous_election text null,
  comment text null,
  gender text null,
  disability text null,
  assign_code text null,
  constraint presiding_pkey primary key (presiding_iid)
) TABLESPACE pg_default;


where table public.ass_presiding_list (
  ass_presiding_iid bigint generated by default as identity not null,
  ass_presiding_name text null,
  mobile_number text null,
  sallery_scale text null,
  current_grade_sallery text null,
  date_of_birth text null,
  own_discrict text null,
  address text null,
  "Nid_number" text null,
  previous_election text null,
  comment text null,
  gender text null,
  disability text null,
  assign_code text null,
  constraint ass_presiding_list_pkey primary key (ass_presiding_iid),
  constraint ass_presiding_list_ass_presiding_iid_key unique (ass_presiding_iid)
) TABLESPACE pg_default;



where table public.polling_list (
  polling_iid bigint generated by default as identity not null,
  polling_name text null,
  mobile_number text null,
  sallery_scale text null,
  current_grade_sallery text null,
  date_of_birth text null,
  own_discrict text null,
  address text null,
  "Nid_number" text null,
  previous_election text null,
  comment text null,
  gender text null,
  disability text null,
  assign_code text null,
  constraint polling_list_pkey primary key (polling_iid),
  constraint polling_list_polling_sl_key unique (polling_iid)
) TABLESPACE pg_default;



create table public.centre_assignments (
  assignment_id bigserial not null,
  vote_centre_iid integer not null,
  vote_centre_code text not null,
  officer_type text not null,
  officer_iid integer not null,
  officer_name text null,
  officer_designation text null,
  officer_gender text null,
  booth_number integer null,
  person_number integer null,
  assign_code text not null,
  created_at timestamp with time zone null default now(),
  updated_at timestamp with time zone null default now(),
  change_record text null,
  constraint centre_assignments_pkey primary key (assignment_id),
  constraint unique_assignment unique (vote_centre_iid, officer_type, officer_iid),
  constraint centre_assignments_officer_type_check check (
    (
      officer_type = any (
        array[
          'presiding'::text,
          'ass_presiding'::text,
          'polling'::text
        ]
      )
    )
  )
) TABLESPACE pg_default;

create index IF not exists idx_centre_assignments_vote_centre on public.centre_assignments using btree (vote_centre_iid) TABLESPACE pg_default;

create index IF not exists idx_centre_assignments_officer_type on public.centre_assignments using btree (officer_type) TABLESPACE pg_default;

create index IF not exists idx_centre_assignments_assign_code on public.centre_assignments using btree (assign_code) TABLESPACE pg_default;

create index IF not exists idx_centre_assignments_created_at on public.centre_assignments using btree (created_at desc) TABLESPACE pg_default;

create trigger trigger_update_centre_assignments_updated_at BEFORE
update on centre_assignments for EACH row
execute FUNCTION update_centre_assignments_updated_at ();




create table public.request_table (
  request_id bigint generated by default as identity not null,
  created_at timestamp with time zone not null default now(),
  officer_name text null,
  officer_table_name text null,
  officer_table_iid text null,
  vote_centre_iid text null,
  vote_centre_code text null,
  vote_centre_name text null,
  constraint request_table_pkey primary key (request_id)
) TABLESPACE pg_default;




create table public.election_result (
  result_iid bigint generated by default as identity not null,
  vote_centre_iid numeric not null,
  vote_centre_code numeric null,
  candidate_1 numeric null,
  candidate_2 numeric null,
  candidate_3 numeric null,
  candidate_4 numeric null,
  candidate_5 numeric null,
  candidate_6 numeric null,
  candidate_7 numeric null,
  candidate_8 numeric null,
  candidate_9 numeric null,
  candidate_10 numeric null,
  candidate_11 numeric null,
  valid_counted_vote numeric null,
  invalid_counted_vote numeric null,
  tenderd_counted_vote text null,
  s_comment numeric null,
  yes_vote numeric null,
  no_vote numeric null,
  rejected_gonovote numeric null,
  constraint election_result_pkey primary key (result_iid)
) TABLESPACE pg_default;




create table public.candidate_db (
  candidate_iid bigint generated by default as identity not null,
  candidate_sl numeric null,
  candidate_name text null,
  candidate_sign_name text null,
  candidate_party text null,
  candidate_sign_url text null,
  candidate_comment text null,
  candidate_father text null,
  candidate_address text null,
  candidate_identity text null,
  constraint candidate_db_pkey primary key (candidate_iid),
  constraint candidate_db_candidate_iid_key unique (candidate_iid)
) TABLESPACE pg_default;


-- request_table এর অফিসারকে তার নির্ধারিত কেন্দ্রেই এসাইন করার জন্য
-- (অটো-অ্যাসাইনমেন্টের আগে এই ইনসার্টগুলো চালান)

-- Presiding
insert into public.centre_assignments (
  vote_centre_iid,
  vote_centre_code,
  officer_type,
  officer_iid,
  officer_name,
  officer_designation,
  booth_number,
  assign_code
)
select
  r.vote_centre_iid::int,
  r.vote_centre_code,
  'presiding'::text,
  p.presiding_iid,
  p.presiding_name,
  p.sallery_scale,
  null,
  r.vote_centre_iid::text
from public.request_table r
join public.presiding_list p
  on p.presiding_iid::text = r.officer_table_iid
where r.officer_table_name = 'presiding'
on conflict (vote_centre_iid, officer_type, officer_iid) do nothing;

-- Assistant Presiding
insert into public.centre_assignments (
  vote_centre_iid,
  vote_centre_code,
  officer_type,
  officer_iid,
  officer_name,
  officer_designation,
  booth_number,
  assign_code
)
select
  r.vote_centre_iid::int,
  r.vote_centre_code,
  'ass_presiding'::text,
  a.ass_presiding_iid,
  a.ass_presiding_name,
  a.sallery_scale,
  null,
  r.vote_centre_iid::text
from public.request_table r
join public.ass_presiding_list a
  on a.ass_presiding_iid::text = r.officer_table_iid
where r.officer_table_name = 'ass_presiding'
on conflict (vote_centre_iid, officer_type, officer_iid) do nothing;

-- Polling
insert into public.centre_assignments (
  vote_centre_iid,
  vote_centre_code,
  officer_type,
  officer_iid,
  officer_name,
  officer_designation,
  booth_number,
  person_number,
  assign_code
)
select
  r.vote_centre_iid::int,
  r.vote_centre_code,
  'polling'::text,
  pl.polling_iid,
  pl.polling_name,
  pl.sallery_scale,
  null,
  null,
  r.vote_centre_iid::text
from public.request_table r
join public.polling_list pl
  on pl.polling_iid::text = r.officer_table_iid
where r.officer_table_name = 'polling'
on conflict (vote_centre_iid, officer_type, officer_iid) do nothing;